<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">engineTorque</span>,<span class="var type1" id="S3T1U4">motorTorque</span>] = solveGame(<span class="var type0" id="S4T0U7">requiredTorque</span>, <span class="var type0" id="S5T0U8">previousReqTorque</span>,<span class="var type0" id="S6T0U9">previousEngTorque</span>, <span class="var type0" id="S7T0U10">previousMotTorque</span>, <span class="var type0" id="S8T0U11">SOC</span>, <span class="var type0" id="S9T0U12">fuelConsumed</span>, <span class="var type1" id="S10T23U13">FuelConsTable</span>, <span class="var type1" id="S11T39U14">GasEmisTable</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line">    coder.extrinsic(<span class="string">'int2str'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line">    coder.extrinsic(<span class="string">'ismembertol'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">    coder.extrinsic(<span class="string">'knnsearch'</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line">    coder.extrinsic(<span class="string">'legend'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line">    coder.extrinsic(<span class="string">'roundn'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line">    <span class="mxinfo " id="T1:U5"><span class="var type1" id="S13T1U47">requiredTorqueR</span> = <span class="mxinfo " id="T1:U7">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line">    <span class="mxinfo " id="T1:U8"><span class="var type1" id="S13T1U51">requiredTorqueR</span> = <span class="mxinfo " id="T42:U10"><span class="extrinsicFcn" id="F2N12:B53">roundn</span>(<span class="var type1" id="S4T1U54">requiredTorque</span>,<span class="mxinfo " id="T1:U12">0</span>)</span></span>;     </span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U13"><span class="var type1" id="S5T1U59">previousReqTorque</span> == <span class="var type1" id="S13T1U60">requiredTorqueR</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">        <span class="mxinfo " id="T1:U16"><span class="var type1" id="S2T1U63">engineTorque</span> = <span class="var type1" id="S6T1U64">previousEngTorque</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">        <span class="mxinfo " id="T1:U19"><span class="var type1" id="S3T1U67">motorTorque</span> = <span class="var type1" id="S7T1U68">previousMotTorque</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T2:U22"><span class="var type1" id="S13T1U74">requiredTorqueR</span> &gt; <span class="mxinfo " id="T1:U24">0</span></span> &amp;&amp; <span class="mxinfo " id="T2:U25"><span class="var type1" id="S13T1U77">requiredTorqueR</span> &lt; <span class="mxinfo " id="T1:U27">70</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line">           <span class="mxinfo " id="T1:U28"><span class="var type1" id="S13T1U81">requiredTorqueR</span> = <span class="mxinfo " id="T1:U30">70</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">           <span class="mxinfo " id="T1:U31"><span class="var type1" id="S2T1U85">engineTorque</span> = <span class="mxinfo " id="T1:U33">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">           <span class="mxinfo " id="T1:U34"><span class="var type1" id="S3T1U89">motorTorque</span> = <span class="mxinfo " id="T1:U36">70</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T2:U37"><span class="var type1" id="S13T1U93">requiredTorqueR</span> == <span class="mxinfo " id="T1:U39">0</span></span>          </span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">            <span class="mxinfo " id="T1:U40"><span class="var type1" id="S2T1U97">engineTorque</span> = <span class="mxinfo " id="T1:U42">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">            <span class="mxinfo " id="T1:U43"><span class="var type1" id="S3T1U101">motorTorque</span> = <span class="mxinfo " id="T1:U45">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">            close <span class="string">all</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">            <span class="mxinfo " id="T3:U46"><span class="var type1" id="S16T3U109">motorSpeedCurve</span> = <span class="mxinfo " id="T3:U48">[0, 1200, 2000, 3000, 4000, 5000, 6000]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">            <span class="mxinfo " id="T3:U49"><span class="var type1" id="S17T3U121">motorTorqueCurve</span> = <span class="mxinfo " id="T3:U51">[400 399 225 150 100 80 70]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">            <span class="mxinfo " id="T1:U52"><span class="var type1" id="S18T1U133">SOC_deviation</span> = <span class="mxinfo " id="T1:U54">abs(<span class="mxinfo " id="T1:U55"><span class="mxinfo " id="T1:U56">70</span> - <span class="var type1" id="S8T1U138">SOC</span></span>)</span></span>;       </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">            <span class="mxinfo " id="T1:U58"><span class="var type1" id="S20T1U141">maxEngineTorque</span> = <span class="mxinfo " id="T1:U60">136</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">            <span class="mxinfo " id="T1:U61"><span class="var type1" id="S21T1U145">maxMotorTorque</span> = <span class="mxinfo " id="T1:U63">400</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line">            <span class="mxinfo " id="T1:U64"><span class="var type1" id="S22T1U149">minMotorTorque</span> = <span class="mxinfo " id="T1:U66">min(<span class="var type1" id="S17T3U152">motorTorqueCurve</span>)</span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line">            <span class="mxinfo " id="T1:U68"><span class="var type1" id="S24T1U155">minEngineTorque</span> = <span class="mxinfo " id="T1:U70">0</span></span>;<span class="comment">%82.73;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">            <span class="mxinfo " id="T1:U71"><span class="var type1" id="S25T1U159">m</span> = <span class="mxinfo " id="T1:U73">7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line">            <span class="mxinfo " id="T1:U74"><span class="var type1" id="S26T1U163">e</span> = <span class="mxinfo " id="T1:U76">7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line">            <span class="mxinfo " id="T22:U77"><span class="var type1" id="S27T22U167">payoffMotor</span> = <span class="mxinfo " id="T22:U79">zeros(<span class="mxinfo " id="T1:U80"><span class="var type1" id="S25T1U170">m</span></span>,<span class="mxinfo " id="T1:U82"><span class="var type1" id="S26T1U171">e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line">            <span class="mxinfo " id="T22:U84"><span class="var type1" id="S29T22U174">payoffEngine</span> = <span class="mxinfo " id="T22:U86">zeros(<span class="mxinfo " id="T1:U87"><span class="var type1" id="S25T1U177">m</span></span>,<span class="mxinfo " id="T1:U89"><span class="var type1" id="S26T1U178">e</span></span>)</span></span>;      </span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T2:U91"><span class="var type1" id="S4T1U182">requiredTorque</span> &lt; <span class="mxinfo " id="T1:U93">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">                <span class="mxinfo " id="T1:U94"><span class="var type1" id="S30T1U186">maxMotorTorqueStrategy</span> = <span class="mxinfo " id="T1:U96">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">                <span class="mxinfo " id="T1:U97"><span class="var type1" id="S31T1U190">maxEngineTorqueStrategy</span> = <span class="mxinfo " id="T1:U99">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">                <span class="mxinfo " id="T1:U100"><span class="var type1" id="S32T1U194">minEngineTorqueStrategy</span> = <span class="mxinfo " id="T1:U102">max(<span class="mxinfo " id="T1:U103"><span class="var type1" id="S24T1U197">minEngineTorque</span></span>, <span class="var type1" id="S4T1U198">requiredTorque</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">                <span class="mxinfo " id="T1:U106"><span class="var type1" id="S34T1U201">minMotorTorqueStrategy</span> = <span class="mxinfo " id="T1:U108">max(<span class="mxinfo " id="T1:U109"><span class="var type1" id="S22T1U204">minMotorTorque</span></span>, <span class="var type1" id="S4T1U205">requiredTorque</span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">                <span class="mxinfo " id="T3:U112"><span class="var type1" id="S35T3U208">strategyMot</span> = <span class="mxinfo " id="T3:U114">linspace(<span class="var type1" id="S34T1U211">minMotorTorqueStrategy</span>, <span class="mxinfo " id="T1:U116"><span class="var type1" id="S30T1U212">maxMotorTorqueStrategy</span></span>, <span class="var type1" id="S25T1U213">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">                <span class="mxinfo " id="T3:U119"><span class="var type1" id="S37T3U216">strategyEng</span> = <span class="mxinfo " id="T3:U121">linspace(<span class="var type1" id="S32T1U219">minEngineTorqueStrategy</span>, <span class="mxinfo " id="T1:U123"><span class="var type1" id="S31T1U220">maxEngineTorqueStrategy</span></span>,<span class="var type1" id="S26T1U221">e</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">                <span class="mxinfo " id="T1:U126"><span class="var type1" id="S32T1U225">minEngineTorqueStrategy</span> = <span class="mxinfo " id="T1:U128">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">                <span class="mxinfo " id="T1:U129"><span class="var type1" id="S34T1U229">minMotorTorqueStrategy</span> = <span class="mxinfo " id="T1:U131">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">                <span class="mxinfo " id="T1:U132"><span class="var type1" id="S31T1U233">maxEngineTorqueStrategy</span> = <span class="mxinfo " id="T1:U134">min(<span class="mxinfo " id="T8:U135">[<span class="var type1" id="S4T1U238">requiredTorque</span> <span class="mxinfo " id="T1:U137"><span class="var type1" id="S20T1U239">maxEngineTorque</span></span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">                <span class="mxinfo " id="T1:U139"><span class="var type1" id="S30T1U242">maxMotorTorqueStrategy</span> = <span class="mxinfo " id="T1:U141">min(<span class="mxinfo " id="T8:U142">[<span class="var type1" id="S4T1U247">requiredTorque</span> <span class="mxinfo " id="T1:U144"><span class="var type1" id="S21T1U248">maxMotorTorque</span></span>]</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">                <span class="keyword">if</span> <span class="message error" id="M1F1C">minMotorTorqueRef</span> &gt; <span class="var type0" id="S30T0U254">maxMotorTorqueStrategy</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">                    <span class="mxinfo " id="T3:U146"><span class="var type1" id="S35T3U257">strategyMot</span> = <span class="mxinfo " id="T3:U148">zeros(<span class="mxinfo " id="T1:U149">1</span>,<span class="mxinfo " id="T1:U150"><span class="var type1" id="S25T1U261">m</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">                    <span class="var type0" id="S35T0U265">strategyMot</span> = linspace(<span class="message error" id="M2F1C">minMotorTorqueRef</span>, <span class="var type0" id="S30T0U270">maxMotorTorqueStrategy</span>, <span class="var type0" id="S25T0U271">m</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">                <span class="keyword">if</span> <span class="message error" id="M3F1C">minEngineTorqueRef</span> &gt; <span class="var type0" id="S31T0U277">maxEngineTorqueStrategy</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">                    <span class="mxinfo " id="T3:U152"><span class="var type1" id="S37T3U280">strategyEng</span> = <span class="mxinfo " id="T3:U154">zeros(<span class="mxinfo " id="T1:U155">1</span>,<span class="mxinfo " id="T1:U156"><span class="var type1" id="S26T1U284">e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">                    <span class="var type0" id="S37T0U288">strategyEng</span> = linspace(<span class="message error" id="M4F1C">minEngineTorqueRef</span>, <span class="var type0" id="S31T0U293">maxEngineTorqueStrategy</span>,<span class="var type0" id="S26T0U294">e</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">            <span class="keyword">end</span>          </span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">            <span class="mxinfo " id="T22:U158"><span class="var type1" id="S40T22U297">tmpTorque</span> = <span class="mxinfo " id="T22:U160">repmat(<span class="mxinfo " id="T16:U161"><span class="var type1" id="S37T3U301">strategyEng</span>'</span>,1,<span class="var type1" id="S25T1U303">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">            <span class="mxinfo " id="T22:U164"><span class="var type1" id="S42T22U306">totalTorque</span> = <span class="mxinfo " id="T22:U166">zeros(<span class="mxinfo " id="T1:U167"><span class="var type1" id="S25T1U309">m</span></span>, <span class="mxinfo " id="T1:U169"><span class="var type1" id="S26T1U310">e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S43T1U313">i</span> = <span class="mxinfo " id="T16:U172"><span class="mxinfo " id="T1:U173">1</span>:<span class="var type1" id="S25T1U316">m</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S44T1U319">j</span> = <span class="mxinfo " id="T16:U176"><span class="mxinfo " id="T1:U177">1</span>:<span class="var type1" id="S26T1U322">e</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">                    <span class="mxinfo " id="T1:U179"><span class="mxinfo " id="T1:U180"><span class="var type1" id="S42T22U326">totalTorque</span>(<span class="var type1" id="S43T1U327">i</span>,<span class="var type1" id="S44T1U328">j</span>)</span> = <span class="mxinfo " id="T1:U184"><span class="mxinfo " id="T1:U185"><span class="var type1" id="S40T22U331">tmpTorque</span>(<span class="var type1" id="S43T1U332">i</span>,<span class="var type1" id="S44T1U333">j</span>)</span> + <span class="mxinfo " id="T1:U189"><span class="var type1" id="S35T3U335">strategyMot</span>(<span class="var type1" id="S44T1U336">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">            <span class="keyword">end</span>      </span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">            <span class="comment">% weights     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">            <span class="mxinfo " id="T1:U192"><span class="var type1" id="S45T1U339">wFuel</span> = <span class="mxinfo " id="T1:U194">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">            <span class="mxinfo " id="T1:U195"><span class="var type1" id="S46T1U343">wPower</span> = <span class="mxinfo " id="T1:U197">0.5</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">            <span class="mxinfo " id="T1:U198"><span class="var type1" id="S47T1U347">wTank</span> = <span class="mxinfo " id="T1:U200">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">            <span class="mxinfo " id="T1:U201"><span class="var type1" id="S48T1U351">wDrDem</span> = <span class="mxinfo " id="T1:U203">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">            <span class="mxinfo " id="T1:U204"><span class="var type1" id="S49T1U355">wSOC</span> = <span class="mxinfo " id="T1:U206">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">            <span class="mxinfo " id="T1:U207"><span class="var type1" id="S50T1U359">wNOX</span> = <span class="mxinfo " id="T1:U209">65</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">            <span class="mxinfo " id="T1:U210"><span class="var type1" id="S51T1U363">wCO</span> = <span class="mxinfo " id="T1:U212">25</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">            <span class="mxinfo " id="T1:U213"><span class="var type1" id="S52T1U367">wHC</span> = <span class="mxinfo " id="T1:U215">45</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">            <span class="mxinfo " id="T3:U216"><span class="var type1" id="S53T3U371">motorSpeedRef</span> = <span class="mxinfo " id="T3:U218">zeros(<span class="mxinfo " id="T1:U219">1</span>,<span class="mxinfo " id="T1:U220"><span class="var type1" id="S26T1U375">e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">            <span class="mxinfo " id="T3:U222"><span class="var type1" id="S54T3U378">powerMotorKW</span> = <span class="mxinfo " id="T3:U224">zeros(<span class="mxinfo " id="T1:U225">1</span>,<span class="mxinfo " id="T1:U226"><span class="var type1" id="S26T1U382">e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">            <span class="mxinfo " id="T22:U228"><span class="var type1" id="S55T22U385">torqueDeviation</span> = <span class="mxinfo " id="T22:U230">zeros(<span class="mxinfo " id="T1:U231"><span class="var type1" id="S25T1U388">m</span></span>,<span class="mxinfo " id="T1:U233"><span class="var type1" id="S26T1U389">e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">            <span class="mxinfo " id="T16:U235"><span class="var type1" id="S56T16U392">fuel</span> = <span class="mxinfo " id="T16:U237">zeros(<span class="mxinfo " id="T1:U238"><span class="var type1" id="S26T1U395">e</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            <span class="mxinfo " id="T16:U240"><span class="var type1" id="S57T16U399">nox</span> = <span class="mxinfo " id="T16:U242">zeros(<span class="mxinfo " id="T1:U243"><span class="var type1" id="S26T1U402">e</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">            <span class="mxinfo " id="T16:U245"><span class="var type1" id="S58T16U406">power</span> = <span class="mxinfo " id="T16:U247">zeros(<span class="mxinfo " id="T1:U248"><span class="var type1" id="S26T1U409">e</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S43T1U413">i</span> = <span class="mxinfo " id="T16:U251"><span class="mxinfo " id="T1:U252">1</span>:<span class="var type1" id="S25T1U416">m</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S44T1U419">j</span> = <span class="mxinfo " id="T16:U255"><span class="mxinfo " id="T1:U256">1</span>:<span class="var type1" id="S26T1U422">e</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">                    <span class="mxinfo " id="T24:U258"><span class="var type1" id="S59T24U425">tmpT</span> = <span class="mxinfo " id="T24:U260">abs(<span class="mxinfo " id="T24:U261"><span class="mxinfo " id="T24:U262"><span class="mxinfo " id="T23:U263"><span class="var type1" id="S10T23U430">FuelConsTable</span></span>.torque</span> - <span class="mxinfo " id="T1:U265"><span class="var type1" id="S37T3U433">strategyEng</span>(<span class="var type1" id="S44T1U434">j</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">                    <span class="mxinfo " id="T1:U268"><span class="var type1" id="S60T1U437">idxT</span> = <span class="mxinfo " id="T1:U270">0</span></span>;                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">                    <span class="comment">% Power(W) = Torque (N.m) x Speed (RPM) / 9.5488</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">                    <span class="comment">% divide by 1000 for kW               </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">                    <span class="mxinfo " id="T1:U271"><span class="mxinfo " id="T1:U272"><span class="var type1" id="S53T3U442">motorSpeedRef</span>(<span class="var type1" id="S44T1U443">j</span>)</span> = <span class="mxinfo " id="T1:U275">interp1(<span class="var type1" id="S17T3U446">motorTorqueCurve</span>, <span class="var type1" id="S16T3U447">motorSpeedCurve</span>, <span class="mxinfo " id="T1:U278"><span class="var type1" id="S35T3U449">strategyMot</span>(<span class="var type1" id="S44T1U450">j</span>)</span>,<span class="string">'linear'</span>,<span class="string">'extrap'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">                    <span class="mxinfo " id="T1:U281"><span class="mxinfo " id="T1:U282"><span class="var type1" id="S54T3U456">powerMotorKW</span>(<span class="var type1" id="S44T1U457">j</span>)</span> = <span class="mxinfo " id="T1:U285"><span class="mxinfo " id="T1:U286"><span class="mxinfo " id="T1:U287"><span class="mxinfo " id="T1:U288"><span class="var type1" id="S35T3U462">strategyMot</span>(<span class="var type1" id="S44T1U463">j</span>)</span> * <span class="mxinfo " id="T1:U291"><span class="var type1" id="S53T3U465">motorSpeedRef</span>(<span class="var type1" id="S44T1U466">j</span>)</span></span> / <span class="mxinfo " id="T1:U294">9.5488</span></span> / <span class="mxinfo " id="T1:U295">1000</span></span></span>;       </span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">                    <span class="mxinfo " id="T24:U296"><span class="var type1" id="S62T24U471">tmpS</span> = <span class="mxinfo " id="T24:U298">abs(<span class="mxinfo " id="T24:U299"><span class="mxinfo " id="T24:U300"><span class="mxinfo " id="T23:U301"><span class="var type1" id="S10T23U476">FuelConsTable</span></span>.speed</span> - <span class="mxinfo " id="T1:U303"><span class="var type1" id="S53T3U479">motorSpeedRef</span>(<span class="var type1" id="S44T1U480">j</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">                    <span class="mxinfo " id="T1:U306"><span class="var type1" id="S63T1U483">idxS</span> = <span class="mxinfo " id="T1:U308">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">                    [<span class="mxinfo " id="T1:U309"><span class="mxinfo " id="T1:U310">~</span></span>, <span class="mxinfo " id="T1:U311"><span class="var type1" id="S63T1U489">idxS</span></span>] = min(<span class="var type1" id="S62T24U492">tmpS</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">                    [<span class="mxinfo " id="T1:U314"><span class="mxinfo " id="T1:U315">~</span></span>, <span class="mxinfo " id="T1:U316"><span class="var type1" id="S60T1U497">idxT</span></span>] = min(<span class="var type1" id="S59T24U500">tmpT</span>);    </span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">                    <span class="mxinfo " id="T1:U319"><span class="var type1" id="S64T1U503">fuelConsumedGPS</span> = <span class="mxinfo " id="T1:U321"><span class="mxinfo " id="T25:U322"><span class="mxinfo " id="T23:U323"><span class="var type1" id="S10T23U506">FuelConsTable</span></span>.lookupTableFuel</span>(<span class="var type1" id="S60T1U508">idxT</span>, <span class="var type1" id="S63T1U509">idxS</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">                    <span class="mxinfo " id="T1:U327"><span class="var type1" id="S65T1U512">HCEmissions</span> = <span class="mxinfo " id="T1:U329"><span class="mxinfo " id="T25:U330"><span class="mxinfo " id="T39:U331"><span class="var type1" id="S11T39U515">GasEmisTable</span></span>.lookupTableHC</span>(<span class="var type1" id="S60T1U517">idxT</span>, <span class="var type1" id="S63T1U518">idxS</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">                    <span class="mxinfo " id="T1:U335"><span class="var type1" id="S66T1U521">COEmissions</span> = <span class="mxinfo " id="T1:U337"><span class="mxinfo " id="T25:U338"><span class="mxinfo " id="T39:U339"><span class="var type1" id="S11T39U524">GasEmisTable</span></span>.lookupTableCO</span>(<span class="var type1" id="S60T1U526">idxT</span>, <span class="var type1" id="S63T1U527">idxS</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">                    <span class="mxinfo " id="T1:U343"><span class="var type1" id="S67T1U530">NOXEmissions</span> = <span class="mxinfo " id="T1:U345"><span class="mxinfo " id="T25:U346"><span class="mxinfo " id="T39:U347"><span class="var type1" id="S11T39U533">GasEmisTable</span></span>.lookupTableNOX</span>(<span class="var type1" id="S60T1U535">idxT</span>, <span class="var type1" id="S63T1U536">idxS</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">                    <span class="mxinfo " id="T1:U351"><span class="mxinfo " id="T1:U352"><span class="var type1" id="S55T22U540">torqueDeviation</span>(<span class="var type1" id="S43T1U541">i</span>,<span class="var type1" id="S44T1U542">j</span>)</span> = <span class="mxinfo " id="T1:U356"><span class="var type1" id="S13T1U544">requiredTorqueR</span> - <span class="mxinfo " id="T1:U358"><span class="var type1" id="S42T22U546">totalTorque</span>(<span class="var type1" id="S43T1U547">i</span>,<span class="var type1" id="S44T1U548">j</span>)</span></span></span>;             </span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">                    <span class="mxinfo " id="T1:U362"><span class="mxinfo " id="T1:U363"><span class="var type1" id="S29T22U552">payoffEngine</span>(<span class="var type1" id="S43T1U553">i</span>,<span class="var type1" id="S44T1U554">j</span>)</span> = <span class="mxinfo " id="T1:U367"><span class="mxinfo " id="T1:U368"><span class="mxinfo " id="T1:U369"><span class="mxinfo " id="T1:U370"><span class="mxinfo " id="T1:U371"><span class="mxinfo " id="T1:U372"><span class="mxinfo " id="T1:U373"><span class="var type1" id="S45T1U561">wFuel</span></span>*<span class="var type1" id="S64T1U562">fuelConsumedGPS</span></span> + <span class="mxinfo " id="T1:U376"><span class="mxinfo " id="T1:U377"><span class="var type1" id="S48T1U564">wDrDem</span></span>*<span class="mxinfo " id="T1:U379">abs(<span class="mxinfo " id="T1:U380"><span class="var type1" id="S55T22U568">torqueDeviation</span>(<span class="var type1" id="S43T1U569">i</span>,<span class="var type1" id="S44T1U570">j</span>)</span>)</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T1:U362"><span class="mxinfo " id="T1:U367"><span class="mxinfo " id="T1:U368"><span class="mxinfo " id="T1:U369"><span class="mxinfo " id="T1:U370">                        <span class="mxinfo " id="T1:U384"><span class="mxinfo " id="T1:U385"><span class="var type1" id="S52T1U572">wHC</span></span>*<span class="var type1" id="S65T1U573">HCEmissions</span></span></span> + <span class="mxinfo " id="T1:U388"><span class="mxinfo " id="T1:U389"><span class="var type1" id="S51T1U575">wCO</span></span>*<span class="var type1" id="S66T1U576">COEmissions</span></span></span> + <span class="mxinfo " id="T1:U392"><span class="mxinfo " id="T1:U393"><span class="var type1" id="S50T1U578">wNOX</span></span>*<span class="var type1" id="S67T1U579">NOXEmissions</span></span></span> + <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T1:U362"><span class="mxinfo " id="T1:U367">                        <span class="mxinfo " id="T1:U396"><span class="mxinfo " id="T1:U397"><span class="var type1" id="S47T1U581">wTank</span></span>*<span class="var type1" id="S9T1U582">fuelConsumed</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">                    <span class="mxinfo " id="T1:U400"><span class="mxinfo " id="T1:U401"><span class="var type1" id="S27T22U586">payoffMotor</span>(<span class="var type1" id="S43T1U587">i</span>,<span class="var type1" id="S44T1U588">j</span>)</span> = <span class="mxinfo " id="T1:U405"><span class="mxinfo " id="T1:U406"><span class="mxinfo " id="T1:U407"><span class="mxinfo " id="T1:U408"><span class="var type1" id="S48T1U592">wDrDem</span></span>*<span class="mxinfo " id="T1:U410">abs(<span class="mxinfo " id="T1:U411"><span class="var type1" id="S55T22U596">torqueDeviation</span>(<span class="var type1" id="S43T1U597">i</span>,<span class="var type1" id="S44T1U598">j</span>)</span>)</span></span> + <span class="mxinfo " id="T1:U415"><span class="mxinfo " id="T1:U416"><span class="var type1" id="S46T1U600">wPower</span></span>*<span class="mxinfo " id="T1:U418"><span class="var type1" id="S54T3U602">powerMotorKW</span>(<span class="var type1" id="S44T1U603">j</span>)</span></span></span> + <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T1:U400"><span class="mxinfo " id="T1:U405">                        <span class="mxinfo " id="T1:U421"><span class="mxinfo " id="T1:U422"><span class="var type1" id="S49T1U605">wSOC</span></span>*<span class="var type1" id="S18T1U606">SOC_deviation</span></span></span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">                    <span class="mxinfo " id="T1:U425"><span class="mxinfo " id="T1:U426"><span class="var type1" id="S56T16U610">fuel</span>(<span class="var type1" id="S44T1U611">j</span>,<span class="mxinfo " id="T1:U429">1</span>)</span> = <span class="var type1" id="S64T1U613">fuelConsumedGPS</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">                    <span class="mxinfo " id="T1:U431"><span class="mxinfo " id="T1:U432"><span class="var type1" id="S57T16U617">nox</span>(<span class="var type1" id="S44T1U618">j</span>,<span class="mxinfo " id="T1:U435">1</span>)</span> = <span class="var type1" id="S67T1U620">NOXEmissions</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">                    <span class="mxinfo " id="T1:U437"><span class="mxinfo " id="T1:U438"><span class="var type1" id="S58T16U624">power</span>(<span class="var type1" id="S44T1U625">j</span>,<span class="mxinfo " id="T1:U441">1</span>)</span> = <span class="mxinfo " id="T1:U442"><span class="var type1" id="S54T3U628">powerMotorKW</span>(<span class="var type1" id="S44T1U629">j</span>)</span></span>;                                </span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">            <span class="mxinfo " id="T54:U445"><span class="var type1" id="S68T54U632">paretoStrategies</span> = <span class="mxinfo " id="T54:U447">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">            <span class="mxinfo " id="T54:U448"><span class="var type1" id="S69T54U637">paretoIndex</span> = <span class="mxinfo " id="T54:U450">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">            <span class="var type1" id="S29T22U641">payoffEngine</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">            <span class="var type1" id="S27T22U643">payoffMotor</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">            [<span class="mxinfo " id="T41:U453"><span class="var type1" id="S68T41U647">paretoStrategies</span></span>, <span class="mxinfo " id="T41:U455"><span class="var type1" id="S69T41U648">paretoIndex</span></span>, <span class="mxinfo " id="T1:U457"><span class="mxinfo " id="T40:U458">~</span></span>, <span class="mxinfo " id="T1:U459"><span class="mxinfo " id="T1:U460">~</span></span>] = <span class="fcn" id="F226N10:B652">paretoset</span>(<span class="var type1" id="S29T22U653">payoffEngine</span>, <span class="var type1" id="S27T22U654">payoffMotor</span>);       </span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">            <span class="mxinfo " id="T44:U463"><span class="var type1" id="S71T44U657">payoffE</span> = <span class="mxinfo " id="T44:U465">reshape(<span class="var type1" id="S29T22U660">payoffEngine</span>,(<span class="var type1" id="S25T1U663">m</span>)*(<span class="var type1" id="S26T1U665">e</span>),1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">            <span class="mxinfo " id="T44:U469"><span class="var type1" id="S73T44U669">payoffM</span> = <span class="mxinfo " id="T44:U471">reshape(<span class="var type1" id="S27T22U672">payoffMotor</span>,(<span class="var type1" id="S25T1U675">m</span>)*(<span class="var type1" id="S26T1U677">e</span>),1)</span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">            <span class="mxinfo " id="T53:U475"><span class="var type1" id="S74T53U681">payoffBoth</span> = <span class="mxinfo " id="T53:U477">horzcat(<span class="var type1" id="S71T44U684">payoffE</span>, <span class="var type1" id="S73T44U685">payoffM</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">            <span class="mxinfo " id="T45:U480"><span class="var type1" id="S76T45U688">engineTorquePareto</span> = <span class="mxinfo " id="T45:U482"><span class="var type1" id="S37T3U690">strategyEng</span>(<span class="mxinfo " id="T52:U484"><span class="var type1" id="S69T41U692">paretoIndex</span>(<span class="mxinfo " id="T55:U486">:</span>,<span class="mxinfo " id="T1:U487">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">            <span class="mxinfo " id="T45:U488"><span class="var type1" id="S77T45U697">motorTorquePareto</span> = <span class="mxinfo " id="T45:U490"><span class="var type1" id="S35T3U699">strategyMot</span>(<span class="mxinfo " id="T52:U492"><span class="var type1" id="S69T41U701">paretoIndex</span>(<span class="mxinfo " id="T55:U494">:</span>,<span class="mxinfo " id="T1:U495">2</span>)</span>)</span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">            <span class="mxinfo " id="T42:U496"><span class="var type1" id="S78T42U706">stringRequiredTorque</span> = <span class="mxinfo " id="T42:U498"><span class="extrinsicFcn" id="F264N8:B708">int2str</span>(<span class="var type1" id="S13T1U709">requiredTorqueR</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">            [ <span class="mxinfo " id="T52:U500"><span class="var type1" id="S80T52U713">bestPayoffEngPareto</span></span>, <span class="mxinfo " id="T52:U502"><span class="var type1" id="S81T52U714">bestPayoffMotPareto</span></span> ] = <span class="fcn" id="F265N3:B716">bestpareto</span>( <span class="var type1" id="S68T41U717">paretoStrategies</span>, <span class="var type1" id="S69T41U718">paretoIndex</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">            <span class="var type1" id="S55T22U719">torqueDeviation</span>, <span class="var type1" id="S56T16U720">fuel</span>, <span class="var type1" id="S57T16U721">nox</span>, <span class="var type1" id="S58T16U722">power</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">    <span class="comment">%         numStratBoth = m+e;  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">    <span class="comment">%        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">    <span class="comment">%         [nashEqPl1, nashEqPl2] = LemkeHowson(-payoffEngine, -payoffMotor, ceil(1/2*numStratBoth));                     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">    <span class="comment">%         payoffEngNash = payoffEngine(nashEqPl1==1, nashEqPl2==1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">    <span class="comment">%         payoffMotNash = payoffMotor(nashEqPl1==1, nashEqPl2==1);       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">    <span class="comment">%         %[~, indM] = min(payoffEngNash);        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">    <span class="comment">%               </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">    <span class="comment">%         conflictPoint = sub2ind([m e], find(nashEqPl1==1), find(nashEqPl2==1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">    <span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">    <span class="comment">%         [~, indNP] = nashsolution(payoffBoth, conflictPoint);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">    <span class="comment">%         payoffEngNashSol = payoffBoth(indNP,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">    <span class="comment">%         payoffMotNashSol = payoffBoth(indNP,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">    <span class="comment">%         paretoStrInd = horzcat(paretoStrategies, paretoIndex);        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">    <span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">    <span class="comment">%         [ks, linePareto] = kalaismorodinskysolution(payoffBoth, conflictPoint, paretoStrategies, paretoStrInd);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">    <span class="comment">%         percentReqTorq = linspace(0, requiredTorqueR, 10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">    <span class="comment">%         probKsMixed = zeros(1,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">    <span class="comment">%         ksMixed = zeros(1,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">    <span class="comment">%         if ~isempty(linePareto)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">    <span class="comment">%             if linePareto(2,1) - linePareto(1,1) ~=0 &amp;&amp; linePareto(1,2) - linePareto(2,2) ~= 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">    <span class="comment">%                 probKsMixed(1) = (ks(1,1) - linePareto(1,1)) / (linePareto(2,1) - linePareto(1,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">    <span class="comment">%                 probKsMixed(2) = (ks(1,2) - min(linePareto(:,2))) / (linePareto(1,2) - linePareto(2,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">    <span class="comment">%             elseif linePareto(2,1) - linePareto(1,1) == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">    <span class="comment">%                 probKsMixed(2) = (ks(1,2) - min(linePareto(:,2))) / (linePareto(1,2) - linePareto(2,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">    <span class="comment">%                 probKsMixed(1) = 1 - probKsMixed(2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">    <span class="comment">%             elseif linePareto(1,2) - linePareto(2,2) == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">    <span class="comment">%                  probKsMixed(1) = (ks(1,1) - linePareto(1,1)) / (linePareto(2,1) - linePareto(1,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">    <span class="comment">%                  probKsMixed(2) = 1 - probKsMixed(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">    <span class="comment">%             end             </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">    <span class="comment">%             ksMixed(1) = linePareto(1,1) + probKsMixed(1)*(linePareto(2,1) - linePareto(1,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">    <span class="comment">%             ksMixed(2) = min(linePareto(:,2)) + probKsMixed(2)*abs(linePareto(1,2) - linePareto(2,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">    <span class="comment">%                         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">    <span class="comment">%             mixedEngineTorque = min(strategyEng(linePareto(1,3)),strategyEng(linePareto(2,3))) + <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">    <span class="comment">%                 probKsMixed(1)*abs(strategyEng(linePareto(1,3))-strategyEng(linePareto(2,3)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">    <span class="comment">%             mixedMotorTorque = min(strategyMot(linePareto(1,4)),strategyMot(linePareto(2,4))) + <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">    <span class="comment">%                 probKsMixed(1)*abs(strategyMot(linePareto(1,4))-strategyMot(linePareto(2,4)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">    <span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">    <span class="comment">%         %payoffCoalCoef = ones(m,e);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">    <span class="comment">%         %payoffCoalCoef(m:m-1:end-1) = 0.5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">    <span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">    <span class="comment">%         [ payoffWholeCoal, coeffCoal, payoffEngineCoal, payoffMotorCoal, payoffWholeCoalBefore ] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">    <span class="comment">%             coalitionpayoffs(payoffMotor, payoffEngine, torqueDeviation, percentReqTorq);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">    <span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">    <span class="comment">%         indCoal = (coeffCoal == 0.99 | coeffCoal == 0.991);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">    <span class="comment">%         indCoalition = +indCoal;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">    <span class="comment">%         indCoalition(indCoal == true) = 0.98;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">    <span class="comment">%         indCoalition(indCoal == false) = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">    <span class="comment">%         %payoffWholeCoal1 = payoffWholeCoal .* indCoalition;      </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">    <span class="comment">%     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">    <span class="comment">%         payoffMotCoalVec = reshape(payoffMotorCoal,(m)*(e),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">    <span class="comment">%         payoffEngCoalVec = reshape(payoffEngineCoal,(m)*(e),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">    <span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">    <span class="comment">%         % get all undominated strategies (pareto optimality)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">    <span class="comment">%         [undomImp, undomImpInd] = checkimputation(payoffBoth, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">    <span class="comment">%             paretoStrategies, payoffMotCoalVec, payoffEngCoalVec, payoffWholeCoal);        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">    <span class="comment">%         imputM = zeros(1,size(undomImpInd,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">    <span class="comment">%         imputE = zeros(1,size(undomImpInd,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">    <span class="comment">%         for i = 1 : size(undomImpInd,2)             </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">    <span class="comment">%             if all(undomImp(i,1) &lt;= payoffEngine(m,:))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">    <span class="comment">%                 imputM(1,i) = undomImpInd(i);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">    <span class="comment">%             end                </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">    <span class="comment">%             if all(undomImp(i,2) &lt;= payoffMotor(:,e))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">    <span class="comment">%                 imputE(1,i) = undomImpInd(i);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">    <span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">    <span class="comment">%         coder.varsize('imput');  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">    <span class="comment">%         imput = undomImpInd;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">    <span class="comment">%         imput(imput==0) = [];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">    <span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">    <span class="comment">%         payoffImput = zeros(size(imput,1),3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">    <span class="comment">%         for i = 1 : size(imput,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">    <span class="comment">%             payoffImput(i,1) = payoffBoth(imput(i),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">    <span class="comment">%             payoffImput(i,2) = payoffBoth(imput(i),2);       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">    <span class="comment">%             [r, c] = ind2sub(size(payoffWholeCoal), imput(i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">    <span class="comment">%             payoffImput(i,3) = payoffWholeCoal(r,c);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">    <span class="comment">%                </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">    <span class="comment">%         coreSol = core(payoffImput);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line">    <span class="comment">%         indCore = find(coreSol);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">    <span class="comment">%         Xengine = zeros(m,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">    <span class="comment">%         Xmotor = zeros(m,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">    <span class="comment">%         [Xengine, X2, A1, b1, v1] = mixedstrategies(payoffEngine,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">    <span class="comment">%         [Xmotor, X1, A2, b2, v2] = mixedstrategies(payoffMotor,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">    <span class="comment">%         coder.varsize('payoffStrEng');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">    <span class="comment">%         coder.varsize('payoffStrMot');        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">    <span class="comment">%        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">    <span class="comment">%         if  ~isempty(A1) &amp;&amp; ~isempty(A2) &amp;&amp; ~isempty(b1) &amp;&amp; ~isempty(b2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">    <span class="comment">%             mixedStrEng = find(abs(Xengine-0)&gt;0.001);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">    <span class="comment">%             mixedStrMot = find(abs(Xmotor-0)&gt;0.001);         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">    <span class="comment">%             payoffProbMixedStrEng = zeros(size(mixedStrEng,1),2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">    <span class="comment">%             payoffProbMixedStrMot = zeros(size(mixedStrMot,1),2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">    <span class="comment">%             payoffStrEng = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">    <span class="comment">%             for i = 1 : size(mixedStrEng,1)        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">    <span class="comment">%                 payoffProbMixedStrEng(i,1) = payoffEngine(mixedStrEng(i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">    <span class="comment">%                 payoffProbMixedStrEng(i,2) = Xengine(mixedStrEng(i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">    <span class="comment">%                 payoffStrEng = payoffStrEng + payoffEngine(mixedStrEng(i))*Xengine(mixedStrEng(i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">    <span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">    <span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">    <span class="comment">%             payoffStrMot = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">    <span class="comment">%             for j = 1 : size(mixedStrMot,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">    <span class="comment">%                 payoffProbMixedStrMot(j,1) = payoffMotor(mixedStrMot(j));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">    <span class="comment">%                 payoffProbMixedStrMot(j,2) = Xmotor(mixedStrMot(j));    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">    <span class="comment">%                 payoffStrMot = payoffStrMot + payoffMotor(mixedStrMot(j))*Xmotor(mixedStrMot(j));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">    <span class="comment">%             end         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">    <span class="comment">%         else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">    <span class="comment">%             pureStrEng = find(Xengine);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">    <span class="comment">%             pureStrMot = find(X2);    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">    <span class="comment">%             payoffStrEng = payoffEngine(pureStrEng, pureStrMot);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">    <span class="comment">%             payoffStrMot = payoffMotor(pureStrEng, pureStrMot);           </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">    <span class="comment">%         m1 = min(payoffBoth(:,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">    <span class="comment">%         m2 = min(payoffBoth(:,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line">    <span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">    <span class="comment">%         v12 = min(min(payoffWholeCoalBefore));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line">    <span class="comment">%         [ shEngine, shMotor ] = shapleyvalue(v12, v1, v2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">    <span class="comment">%         if ~ismembertol([shEngine, shMotor],payoffBoth,0.001,'ByRows',true)           </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">    <span class="comment">%             IDX = zeros(1,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">    <span class="comment">%             IDX = knnsearch(payoffBoth,[shEngine shMotor],'K', 2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">    <span class="comment">%             [idr1, idc1] = ind2sub(size(payoffEngine), IDX(1));        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">    <span class="comment">%             [idr2, idc2] = ind2sub(size(payoffEngine), IDX(2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line">    <span class="comment">%             nearestSh1 = [idr1 idc1];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line">    <span class="comment">%             nearestSh2 = [idr2 idc2];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line">    <span class="comment">%             payoffNearestSh1 = [payoffEngine(idr1,idc1) payoffMotor(idr1,idc1)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line">    <span class="comment">%             payoffNearestSh2 = [payoffEngine(idr2,idc2) payoffMotor(idr2,idc2)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line">    <span class="comment">%             probNearSh1 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line">    <span class="comment">%             probNearSh2 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line">    <span class="comment">%             if payoffNearestSh1(1) ~= payoffNearestSh2(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line">    <span class="comment">%                 j = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line">    <span class="comment">%                 shapley = shEngine;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line">    <span class="comment">%             else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line">    <span class="comment">%                 j = 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line">    <span class="comment">%                 shapley = shMotor;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line">    <span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line">    <span class="comment">%             if payoffNearestSh2(j) &lt; shapley &amp;&amp;  <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line">    <span class="comment">%                 shapley &lt; payoffNearestSh1(j)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line">    <span class="comment">%                 probNearSh2 = (shapley - payoffNearestSh2(j)) / <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line">    <span class="comment">%                     (payoffNearestSh1(j) - payoffNearestSh2(j));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line">    <span class="comment">%                 probNearSh1 = 1 - probNearSh2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line">    <span class="comment">%             elseif payoffNearestSh1(j) &lt; shapley &amp;&amp; <span class="keyword">...</span><span class="comment">                    </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line">    <span class="comment">%                 shapley &lt; payoffNearestSh2(j)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line">    <span class="comment">%                 probNearSh1 = (shapley - payoffNearestSh1(j)) / <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line">    <span class="comment">%                     (payoffNearestSh2(j) - payoffNearestSh1(j));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line">    <span class="comment">%                 probNearSh2 = 1 - probNearSh1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line">    <span class="comment">%             elseif shapley &lt; payoffNearestSh1(j) &amp;&amp;  <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line">    <span class="comment">%                 shapley &lt; payoffNearestSh2(j)            </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line">    <span class="comment">%                 if payoffNearestSh1(j) &lt; payoffNearestSh2(j)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line">    <span class="comment">%                     probNearSh1 = shapley / payoffNearestSh1(j);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line">    <span class="comment">%                     probNearSh2 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line">    <span class="comment">%                 elseif payoffNearestSh2(j) &lt; payoffNearestSh1(j)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line">    <span class="comment">%                     probNearSh2 = shapley / payoffNearestSh2(j);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line">    <span class="comment">%                     probNearSh1 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line">    <span class="comment">%                 end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line">    <span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line">    <span class="comment">%             probNearSh1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line">    <span class="comment">%             probNearSh2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line">    <span class="comment">%             shapleyEngineTorque = probNearSh1*strategyEng(idr1) + probNearSh2*strategyEng(idr2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line">    <span class="comment">%             shapleyMotorTorque = probNearSh1*strategyMot(idc1) + probNearSh2*strategyMot(idc2);          </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line">    <span class="comment">%         else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line">    <span class="comment">%              [~, ind] = ismembertol([shEngine, shMotor],payoffBoth,0.001,'ByRows',true); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line">    <span class="comment">%              idr1 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line">    <span class="comment">%              idc1 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line">    <span class="comment">%              [idr1, idc1] = ind2sub(size(payoffEngine), ind);             </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line">    <span class="comment">%              shapleyEngineTorque = strategyEng(idr1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line">    <span class="comment">%              shapleyMotorTorque = strategyMot(idc1);    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line">            <span class="comment">%lightpurple = [163 154 255] ./ 255;        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line">            <span class="comment">%p10 = plot(payoffStrEng, payoffStrMot, 'o',<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor', lightpurple, 'MarkerEdgeColor', lightpurple, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line">            <span class="comment">%    'MarkerSize', 13);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line">            <span class="comment">%limegreen = [194 242 1] ./ 255;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line">            <span class="comment">%p3 = plot(bestPayoffEngPareto, bestPayoffMotPareto, 'og', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor', 'g', 'MarkerSize', 12);    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line">            <span class="comment">%p5 = plot(payoffEngNashNPG, payoffMotNashNPG, 'o', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor','m', 'MarkerEdgeColor', 'm',<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line">            <span class="comment">%    'MarkerSize', 13);    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line">            <span class="comment">%p4 = plot(payoffEngNash, payoffMotNash, 'oy', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor', 'y', 'MarkerSize', 10);     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line">            <span class="comment">%p41 = plot(bestPayoffEngNashLH(1), bestPayoffMotNashLH(1), 'oc', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor', 'c', 'MarkerSize', 9);      </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line">            <span class="comment">%p42 = plot(bestPayoffEngNashLH(2), bestPayoffMotNashLH(2), 'o', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor', 'r', 'MarkerEdgeColor','r','MarkerSize', 7);     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line">            <span class="comment">%p43 = plot(bestPayoffEngNashLH(3), bestPayoffMotNashLH(3), 'o', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor', limegreen,'MarkerEdgeColor', limegreen, 'MarkerSize', 5);         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">            <span class="comment">%p6 = plot(payoffEngNashSol, payoffMotNashSol,'or', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor',[1,0.6,0] , 'MarkerEdgeColor', [1,0.6,0] ,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line">            <span class="comment">%    'MarkerSize', 9);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line">            <span class="comment">%purple = [118 31 133] ./ 255;        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line">            <span class="comment">%p7 = plot(ks(1,1), ks(1,2), 'o', 'MarkerFaceColor', purple, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">            <span class="comment">%    'MarkerEdgeColor', purple, 'MarkerSize', 9);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line">            <span class="comment">%pink = [254 164 191] ./ 255;       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line">            <span class="comment">%p8 = plot(payoffBoth(imput(indCore),1), payoffBoth(imput(indCore),2), 'o', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line">            <span class="comment">%    'MarkerFaceColor',pink, 'MarkerEdgeColor',pink,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line">            <span class="comment">%    'MarkerSize', 8);      </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line">            <span class="comment">%p9 = plot(shEngine, shMotor, 'o', 'MarkerFaceColor', limegreen, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">            <span class="comment">%    'MarkerEdgeColor', limegreen, 'MarkerSize', 7);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">            <span class="comment">%p2 = p9;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">            <span class="comment">%for r = 1 : size(paretoIndex,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line">            <span class="comment">%    linearIndex = sub2ind([m e], paretoIndex(r,2), paretoIndex(r,1));           </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">            <span class="comment">%    p2 = plot(x(linearIndex), y(linearIndex), 'o', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line">            <span class="comment">%        'MarkerEdgeColor', [0,0.5,0], 'MarkerFaceColor',[0,0.5,0],<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line">            <span class="comment">%        'MarkerSize',6);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line">            <span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">            <span class="comment">%darkred = [185 16 20] ./ 255;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line">            <span class="comment">%pi = plot(m1, m2, 'o', 'MarkerSize', 4, 'MarkerFaceColor',darkred ,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line">            <span class="comment">%'MarkerEdgeColor', darkred);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line">            <span class="comment">%legend([p1 p2 p3 p4 p7 p8 p9 p10], 'Payoff', <span class="keyword">...</span><span class="comment">         </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line">            <span class="comment">%'Pareto optimal payoff', <span class="keyword">...</span><span class="comment">  </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line">            <span class="comment">%'Best Pareto payoff', <span class="keyword">...</span><span class="comment"> </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line">            <span class="comment">%'Nash Equilibrium Lemke-Howson (conflict point)', <span class="keyword">...</span><span class="comment"> </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line">            <span class="comment">%'Kalai-Smorodinsky Solution', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line">            <span class="comment">%'Core', <span class="keyword">...</span><span class="comment">        </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line">            <span class="comment">%'Shapley value', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line">            <span class="comment">%'Mixed Strategies', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line">            <span class="comment">%'Location', 'northwest');       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line">            <span class="comment">%'Ideal point', <span class="keyword">...</span><span class="comment">       </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line">            <span class="comment">%'Nash Equilibrium Lemke-Howson k0=1', <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line">            <span class="comment">%'Nash Equilibrium Lemke-Howson k0=8', <span class="keyword">...</span><span class="comment">     </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line">            <span class="comment">%'Nash Equilibrium Lemke-Howson k0=15' , <span class="keyword">...</span><span class="comment"> </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line">            <span class="comment">%'Nash Equilibrium Lemke-Howson k0=23' , <span class="keyword">...</span><span class="comment">          </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line">            <span class="comment">%'Nash Equilibrium NPG', <span class="keyword">...</span><span class="comment">       </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line">            <span class="comment">%xlabel('Payoff Engine');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line">            <span class="comment">%ylabel('Payoff Motor');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line">            <span class="comment">%hold off</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line">            [ <span class="mxinfo " id="T1:U510"><span class="var type1" id="S2T1U726">engineTorque</span></span>, <span class="mxinfo " id="T1:U512"><span class="var type1" id="S3T1U727">motorTorque</span></span> ] = <span class="fcn" id="F298N11:B729">payofftotorque</span>(<span class="var type1" id="S80T52U730">bestPayoffEngPareto</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line">                <span class="var type1" id="S81T52U731">bestPayoffMotPareto</span>, <span class="var type1" id="S74T53U732">payoffBoth</span>, <span class="var type1" id="S37T3U733">strategyEng</span>, <span class="var type1" id="S35T3U734">strategyMot</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line">            <span class="mxinfo " id="T1:U519"><span class="var type1" id="S5T1U737">previousReqTorque</span> = <span class="var type1" id="S13T1U738">requiredTorqueR</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line">            <span class="mxinfo " id="T1:U522"><span class="var type1" id="S6T1U741">previousEngTorque</span> = <span class="var type1" id="S2T1U742">engineTorque</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line">            <span class="mxinfo " id="T1:U525"><span class="var type1" id="S7T1U745">previousMotTorque</span> = <span class="var type1" id="S3T1U746">motorTorque</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line">    <span class="keyword">end</span></span></span>
</pre>
